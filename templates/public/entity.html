{% extends 'base.html' %}
{% block title %}{{ entity_name }}{% endblock %}

{% block content %}
<style>
    /* Scoped styles for the public-facing entity list page */
    :root {
        --public-bg: #ffffff;
        --public-card-bg: #f8f9fa;
        --public-primary: #0d6efd;
        --public-border: #dee2e6;
        --public-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        --public-text-dark: #212529;
        --public-text-light: #6c757d;
        --public-font: 'Poppins', sans-serif;
    }

    .page-container-public {
        font-family: var(--public-font);
        max-width: 1400px; /* Wider container for the grid */
        margin: 2rem auto;
        padding: 2rem;
    }

    .page-header-public {
        text-align: center;
        margin-bottom: 3rem;
    }
    .page-header-public__title {
        font-size: 2.8rem;
        font-weight: 600;
        color: var(--public-text-dark);
    }

    .filter-container {
        margin-bottom: 3rem;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        position: relative;
    }
    .filter-icon {
        position: absolute;
        left: 1.25rem;
        top: 50%;
        transform: translateY(-50%);
        color: #9CA3AF;
        font-size: 1.1rem;
    }
    .filter-input {
        width: 100%;
        padding: 1rem 1rem 1rem 3.5rem;
        font-size: 1.1rem;
        border: 1px solid var(--public-border);
        border-radius: 50px;
        transition: all 0.3s ease;
    }
    .filter-input:focus {
        outline: none;
        border-color: var(--public-primary);
        box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.15);
    }

    /* --- CORRECTED MULTI-COLUMN GRID SYSTEM --- */
    .content-grid-public {
        display: grid;
        grid-template-columns: 1fr; /* 1 column for mobile (default) */
        gap: 2.5rem;
    }
    /* 2 columns for small tablets */
    @media (min-width: 640px) {
        .content-grid-public {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    /* 3 columns for tablets and small desktops */
    @media (min-width: 900px) {
        .content-grid-public {
            grid-template-columns: repeat(3, 1fr);
        }
    }
    /* 4 columns for large desktops */
    @media (min-width: 1280px) {
        .content-grid-public {
            grid-template-columns: repeat(4, 1fr);
        }
    }
    /* --- END OF GRID SYSTEM --- */

    .person-card-public {
        background-color: var(--public-card-bg);
        border: 1px solid var(--public-border);
        border-radius: 16px;
        text-align: center;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: all 0.3s ease;
    }
    .person-card-public:hover {
        transform: translateY(-8px);
        box-shadow: var(--public-shadow);
    }
    
    .person-card-public__image-link {
        display: block;
        width: 150px;
        height: 150px;
        margin-bottom: 1.5rem;
        border-radius: 50%;
        overflow: hidden;
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        border: 4px solid #fff;
        flex-shrink: 0;
    }
    .person-card-public__image {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .person-card-public__info {
        flex-grow: 1; /* Allows this section to fill space */
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    
    .person-card-public__name {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--public-text-dark);
        margin: 0 0 0.25rem 0;
    }
    .person-card-public__position {
        font-size: 1rem;
        color: var(--public-text-light);
        margin: 0 0 1.5rem 0;
    }

    .person-card-public__button {
        display: inline-block;
        background-color: var(--public-primary);
        color: #fff;
        text-decoration: none;
        padding: 10px 24px;
        border-radius: 50px;
        font-weight: 500;
        transition: all 0.3s ease;
    }
    .person-card-public__button:hover {
        background-color: #0b5ed7;
        transform: scale(1.05);
    }
    
    #no-results-message {
        display: none;
        text-align: center;
        margin-top: 3rem;
        font-size: 1.2rem;
        color: var(--public-text-light);
        grid-column: 1 / -1;
    }
</style>

<div class="page-container-public">
    <header class="page-header-public">
        <h1 class="page-header-public__title">Our {{ entity_name }}</h1>
    </header>

    <div class="filter-container">
        <i class="fas fa-search filter-icon"></i>
        <input type="text" id="filter-input" class="filter-input" placeholder="Search by name or position...">
    </div>

    <div class="content-grid-public">
        {% for item in entity_items %}
        <div class="person-card-public" data-name="{{ item.name }}" data-position="{{ item.position }}">
            <a href="{{ url_for(detail_endpoint, id=item.id) }}" class="person-card-public__image-link">
                <img src="{{ item.image_url or url_for('static', filename='images/default-avatar.png') }}" alt="{{ item.name }}" class="person-card-public__image">
            </a>
            <div class="person-card-public__info">
                <div>
                    <h3 class="person-card-public__name">{{ item.name }}</h3>
                    <p class="person-card-public__position">{{ item.position }}</p>
                </div>
                <a href="{{ url_for(detail_endpoint, id=item.id) }}" class="person-card-public__button">
                    View Details
                </a>
            </div>
        </div>
        {% endfor %}
    </div>

    <p id="no-results-message">No {{ entity_name|lower }} found matching your search.</p>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const filterInput = document.getElementById('filter-input');
    const noResultsMessage = document.getElementById('no-results-message');
    const cards = document.querySelectorAll('.person-card-public');

    if (filterInput) {
        filterInput.addEventListener('keyup', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            let visibleCount = 0;

            cards.forEach(card => {
                const name = (card.dataset.name || '').toLowerCase();
                const position = (card.dataset.position || '').toLowerCase();

                if (name.includes(searchTerm) || position.includes(searchTerm)) {
                    card.style.display = 'flex'; // Changed from 'block' to 'flex'
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            if (noResultsMessage) {
                noResultsMessage.style.display = visibleCount === 0 ? 'block' : 'none';
            }
        });
    }
});
</script>
{% endblock %}